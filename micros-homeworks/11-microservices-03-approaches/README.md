# Домашнее задание к занятию "11.03 Микросервисы: подходы"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

> Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
> Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
> 
> Решение должно соответствовать следующим требованиям:
> - Облачная система;
> - Система контроля версий Git;
> - Репозиторий на каждый сервис;
> - Запуск сборки по событию из системы контроля версий;
> - Запуск сборки по кнопке с указанием параметров;
> - Возможность привязать настройки к каждой сборке;
> - Возможность создания шаблонов для различных конфигураций сборок;
> - Возможность безопасного хранения секретных данных: пароли, ключи доступа;
> - Несколько конфигураций для сборки из одного репозитория;
> - Кастомные шаги при сборке;
> - Собственные докер образы для сборки проектов;
> - Возможность развернуть агентов сборки на собственных серверах;
> - Возможность параллельного запуска нескольких сборок;
> - Возможность параллельного запуска тестов;
> 
> Обоснуйте свой выбор.

Оптимально использовать GitLab CI/CD в сочетании с Docker и Kubernetes для сборки, тестирования и развёртывания, а также Vault для хранения секретов.

GitLab - это облачная система, которая предлагает интегрированную систему контроля версий Git и CI/CD. Она позволяет создавать отдельный репозиторий для каждого сервиса и запускать сборку по событию из системы контроля версий или по кнопке с указанием параметров. GitLab также предлагает возможность привязать настройки к каждой сборке и создавать шаблоны для различных конфигураций сборок.

Docker используется для создания и управления контейнерами, которые содержат всё необходимое для работы приложения: код, среду выполнения, библиотеки, переменные окружения и файлы конфигурации. Это позволяет гарантировать, что приложение будет работать одинаково в любой среде. Docker образы могут быть использованы для сборки проектов в GitLab CI/CD.

Kubernetes - это система оркестровки контейнеров, которая позволяет управлять, масштабировать и обновлять приложения, развернутые в контейнерах. Kubernetes может быть использован для развертывания агентов сборки GitLab Runner на собственных серверах. Это позволяет управлять ресурсами, используемыми для сборки, и запускать несколько сборок и тестов параллельно.

Vault от HashiCorp - это инструмент для безопасного хранения и управления секретами. Он может быть использован для хранения паролей, ключей доступа и других секретных данных, которые могут быть использованы в процессе сборки. Vault легко интегрируется с GitLab, что позволяет безопасно использовать секреты в процессе сборки.


Выбор этих инструментов обоснован их широким функционалом, гибкостью, надежностью и возможностью масштабирования. Они позволяют автоматизировать большую часть процесса разработки, что упрощает управление проектом и увеличивает его эффективность. Также, они имеют большое сообщество и хорошую документацию, что облегчает их использование и поддержку.


---

## Задача 2: Логи

> Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
> Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
> 
> Решение должно соответствовать следующим требованиям:
> - Сбор логов в центральное хранилище со всех хостов обслуживающих систему;
> - Минимальные требования к приложениям, сбор логов из stdout;
> - Гарантированная доставка логов до центрального хранилища;
> - Обеспечение поиска и фильтрации по записям логов;
> - Обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
> - Возможность дать ссылку на сохраненный поиск по записям логов;
> 
> Обоснуйте свой выбор.

Для решения этой задачи я рекомендую использовать стек ELK (Elasticsearch, Logstash, Kibana) в сочетании с Fluentd.

Fluentd является открытым источником для сбора данных, который помогает унифицировать сбор и анализ данных. Он имеет плагинную архитектуру, которая позволяет его легко расширять для поддержки новых входных и выходных источников данных.

Elasticsearch - это распределенная система поиска и анализа данных в реальном времени. Он обеспечивает масштабируемое хранилище, поиск и аналитику, а также возможности для полнотекстового поиска.

Logstash - это сервер сбора логов, который обрабатывает данные из множества источников одновременно, преобразует данные и отправляет их в выбранный “stash”, в данном случае - Elasticsearch.

Kibana - это визуализационный интерфейс для данных в Elasticsearch.

Вот как они взаимодействуют:

- Fluentd собирает логи со всех хостов и отправляет их в Logstash.
- Logstash обрабатывает логи, преобразует их в нужный формат и отправляет в Elasticsearch.
- Elasticsearch индексирует и хранит все логи.
- Kibana предоставляет интерфейс для визуализации и анализа логов в Elasticsearch.

Этот стек инструментов обеспечивает мощное и гибкое решение для сбора, хранения, поиска и анализа логов. Он обеспечивает централизованный сбор логов, гарантированную доставку, возможность поиска и фильтрации, а также удобный пользовательский интерфейс. Кроме того, он предлагает возможность предоставления доступа разработчикам для поиска по записям логов и возможность дать ссылку на сохраненный поиск. Это делает его идеальным выбором для обеспечения сбора и анализа логов в микросервисной архитектуре.

P.S. Хотя Fluentd и Logstash оба являются инструментами для сбора, обработки и пересылки логов и имеют много общего, в предложенном мною решении Fluentd используется для сбора логов со всех хостов и доставки их в Logstash. Затем Logstash обрабатывает эти логи и отправляет их в Elasticsearch. Это позволяет использовать преимущества обоих инструментов: надежный сбор логов с Fluentd и гибкую обработку логов с Logstash.

---

## Задача 3: Мониторинг
 
> Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
> Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
> 
> Решение должно соответствовать следующим требованиям:
> - Сбор метрик со всех хостов, обслуживающих систему;
> - Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
> - Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
> - Сбор метрик, специфичных для каждого сервиса;
> - Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
> - Пользовательский интерфейс с возможность настраивать различные панели для отслеживания состояния системы;
> 
> Обоснуйте свой выбор.

Предлагаю использовать зарекомендовавший себя и, можно сказать, классический стек Prometheus и Grafana.

Prometheus - это система мониторинга и сбора метрик, которая поддерживает множество типов метрик, включая указанные в ТЗ метрики состояния ресурсов хостов (CPU, RAM, HDD, Network) и метрики, специфичные для каждого сервиса. Prometheus предлагает мощные возможности для сбора, хранения и анализа метрик, а также поддерживает множество экспортеров для сбора метрик из различных источников.

Grafana - это инструмент визуализации данных, который может быть использован для создания дашбордов для отслеживания состояния системы. Grafana поддерживает множество источников данных, включая Prometheus, и предлагает гибкие возможности для создания запросов и агрегации информации. С помощью Grafana можно создавать и настраивать различные панели для отслеживания состояния системы и предоставлять доступ к этим панелям разработчикам.

Вот как они взаимодействуют:

- Prometheus собирает метрики со всех хостов и сервисов. Эти метрики затем сохраняются в базе данных Prometheus.
- Grafana затем подключается к Prometheus как к источнику данных и выводит информацию на настроенные дашборды.

Этот стек инструментов обеспечивает мощное и гибкое решение для сбора, хранения, анализа и визуализации метрик. Он обеспечивает централизованный сбор метрик, гибкие возможности для анализа и визуализации этих метрик, и удобный пользовательский интерфейс для мониторинга состояния вашей системы. Это делает его идеальным выбором для мониторинга в микросервисной архитектуре. Кроме того, и Prometheus, и Grafana имеют активные сообщества разработчиков и обширную документацию, что облегчает их использование и поддержку.
