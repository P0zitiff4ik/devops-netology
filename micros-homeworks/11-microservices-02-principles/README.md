# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

> Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.
> 
> Решение должно соответствовать следующим требованиям:
> - маршрутизация запросов к нужному сервису на основе конфигурации,
> - возможность проверки аутентификационной информации в запросах,
> - обеспечение терминации HTTPS.
> 
> Обоснуйте свой выбор.

Согласно ресурсу [Geekflare](https://geekflare.com/api-gateway/) топ-5 самых популярных API Gateway выглядят так:
- Kong Gateway
- Apache APISIX
- Tyk
- Ocelot
- Goku

В статье, конечно указано больше решений, но, как правило, для сравнительного анализа отбирают не больше 5 самых подходящих вариантов. Поскольку сейчас есть проблемы с оплатой "иностранного" ПО, для сравнения выберу "community" версии приложений. Таблица ниже:

| Наименование  | Маршрутизация<br/>запросов |                                   Аутентификация                                    |   Терминация HTTPS    | Комментариии                                                                                                                                                                                                                                                                                                                                              |
|---------------|:--------------------------:|:-----------------------------------------------------------------------------------:|:---------------------:|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Kong Gateway  |             Да             | Да, в базовом виде.<br/>То есть без ролей и с ограниченной поддержкой LDAP и OAuth2 |          Да           | Мощный инструмент с большим количеством плагинов и большим сообществом, написанный на Lua с поддержкой NGINX.<br/>В версии Enterprise доступно гораздо больше функционала, но для описанных задач хватит и базовой версии                                                                                                                                 |
| Apache APISIX |             Да             |               Да, посредством использования соответствующего плагина                | Да, посредством NGINX | Основанный на NGINX и etcd API шлюз, ключевой особенностью которого, помимо full open-source, является более быстрый отклик и возможность подключения плагинов в режиме hot loading, а также практически полная кастомизация под нужды пользователей                                                                                                      |
| Tyk           |             Да             |                                         Да                                          |          Да           | Поддерживает GraphQL из коробки, независим от NGINX. За отдельную плату предоставляется Cloud-версия и Self-Managed с дополнительным функционалом, таким как дашборд, SSO и др. Free-версия включает весь необходимый для API шлюза функционал из коробки                                                                                                 |
| Ocelot        |             Да             |                                         Да                                          |          Да           | Fully Open-source. Написан на .NET и разработан для работы с ASP.NET, но поддерживает все те же платформы, которые поддерживаются ASP.NET. Есть некоторые особенности использования и не такая богатая документация, как у предыдущих примеров, из-за чего использование выглядит несколько сложнее                                                       |
| Goku          |             Да             |                                         Да                                          |          Да           | Fully Open-source с более расширенной платной Enerprise-версией. Написан на Go. Разработчик - китайская компания Eolink, поддержка Goku прекращена с 2020 года, вместо него запустили новый проект Apinto, документация к которому есть только на китайском, из-за чего разобраться в функционале очень сложно. Очевидно, ориентирован на китайский рынок |

Исходя из найденной информации, наиболее подходящим решением кажется Apache APISIX из-за полной открытости, а также возможности подстроиться под более строгие нужды организации в будущем за счёт плагинов, как встроенных, так и самописных.

Впрочем, мною не были рассмотрены сервисы, предоставляемые облачными провайдерами и самим сообществом Kubernetes. Очевидно, что при использовании serverless такие решения будут более привлекательными, хоть и менее гибкими.    


## Задача 2: Брокер сообщений

> Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.
> 
> Решение должно соответствовать следующим требованиям:
> - поддержка кластеризации для обеспечения надёжности,
> - хранение сообщений на диске в процессе доставки,
> - высокая скорость работы,
> - поддержка различных форматов сообщений,
> - разделение прав доступа к различным потокам сообщений,
> - простота эксплуатации.
> 
> Обоснуйте свой выбор.

Вот таблица возможностей пяти различных брокеров сообщений:

| Брокер сообщений | Поддержка кластеризации | Хранение сообщений на диске | Высокая скорость работы | Поддержка различных форматов сообщений | Разделение прав доступа | Простота эксплуатации |
|------------------|-------------------------|------------------------------|-------------------------|---------------------------------------|------------------------|----------------------|
| **RabbitMQ**     | Да                      | Да                           | Средняя                | Да                                    | Да                     | Высокая              |
| **Kafka**        | Да                      | Да                           | Высокая                | Да                                    | Да                     | Средняя              |
| **ActiveMQ**     | Да                      | Да                           | Средняя                | Да                                    | Да                     | Высокая              |
| **Redis**        | Да                      | Нет                          | Высокая                | Нет                                   | Да                     | Высокая              |
| **ZeroMQ**       | Нет                     | Нет                          | Высокая                | Да                                    | Нет                    | Средняя              |

На основе этих данных и указанных требований, я бы рекомендовал **Kafka**. Kafka поддерживает кластеризацию для обеспечения надежности, хранит сообщения на диске в процессе доставки, обеспечивает высокую скорость работы, поддерживает различные форматы сообщений и позволяет разделять права доступа к различным потокам сообщений. Единственный недостаток Kafka - это сложность эксплуатации по сравнению с другими брокерами сообщений, но это компенсируется его мощными функциями и высокой производительностью, а также подробной документацией.