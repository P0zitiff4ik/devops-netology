[Задание](https://github.com/netology-code/mnt-homeworks/blob/4df263a46e5f2a05d6c45e92cb261c8c0843460b/09-ci-05-teamcity/README.md)

---

# Домашнее задание к занятию 11 «Teamcity»

<details><summary>

## Подготовка к выполнению

</summary>

1. В Yandex Cloud создайте новый инстанс (4CPU4RAM) на основе образа `jetbrains/teamcity-server`.
2. Дождитесь запуска teamcity, выполните первоначальную настройку.
3. Создайте ещё один инстанс (2CPU4RAM) на основе образа `jetbrains/teamcity-agent`. Пропишите к нему переменную окружения `SERVER_URL: "http://<teamcity_url>:8111"`.
4. Авторизуйте агент.
5. Сделайте fork [репозитория](https://github.com/aragastmatb/example-teamcity).
6. Создайте VM (2CPU4RAM) и запустите playbook.

</details>

> **Решение:**
> В Terraform были созданы две машины, в метаданные одной из которых передавался docker-compose.yaml из файлов ДЗ. Пользовался [этой инструкцией](https://cloud.yandex.com/en/docs/cos/tutorials/coi-with-terraform).
> ![Скрин виртуальных машин в Яндексе](<img/Screenshot 2023-12-13 205211.png>)

## Основная часть

1. Создайте новый проект в teamcity на основе fork.
2. Сделайте autodetect конфигурации.
3. Сохраните необходимые шаги, запустите первую сборку master.

> **Решение:**
> ![Первая сборка](<img/Screenshot 2023-12-13 182546.png>)

4. Поменяйте условия сборки: если сборка по ветке `master`, то должен происходит `mvn clean deploy`, иначе `mvn clean test`.

**Решение:**

> Добавил второе условие Maven test
> ![Новое условие](<img/Screenshot 2023-12-13 190412.png>)

5. Для deploy будет необходимо загрузить `settings.xml` в набор конфигураций maven у teamcity, предварительно записав туда креды для подключения к nexus.

> **Решение:**
> Взял settings.xml из репозитория, креды не менял

6. В pom.xml необходимо поменять ссылки на репозиторий и nexus.

> **Решение:**
> pom.xml
> ![Изменённые настройки](<img/Screenshot 2023-12-13 190728.png>)

7. Запустите сборку по master, убедитесь, что всё прошло успешно и артефакт появился в nexus.

> **Решение:**
> Артефакт в Nexus
> ![Артефакт в Nexus](<img/Screenshot 2023-12-13 190739.png>)

8. Мигрируйте `build configuration` в репозиторий.

> **Решение:**
> Настройки сборки -> Version Control Settings
> ![VCS Roots](<img/image.png>)

9.  Создайте отдельную ветку `feature/add_reply` в репозитории.
10.  Напишите новый метод для класса Welcomer: метод должен возвращать произвольную реплику, содержащую слово `hunter`.

> **Решение:**
> `Wake up, hunter! We have a city to burn!`
> ![Новый метод](<img/2023-12-13_20-32-16.png>)

11.  Дополните тест для нового метода на поиск слова `hunter` в новой реплике.

> **Решение:**
> ![Поиск слова](<img/image-1.png>)

12.   Сделайте push всех изменений в новую ветку репозитория.
13.   Убедитесь, что сборка самостоятельно запустилась, тесты прошли успешно.

> **Решение:**
> Запустились только тесты
> ![Тесты на сторонней ветке](<img/Screenshot 2023-12-13 194824.png>)

14. Внесите изменения из произвольной ветки `feature/add_reply` в `master` через `Merge`.

> **Решение:**
> Успешная сборка на мастере
> ![Сборка на мастере](<img/Screenshot 2023-12-13 195347.png>)

15. Убедитесь, что нет собранного артефакта в сборке по ветке `master`.

> **Решение:**
> Артефактов нет
> ![Artifacts](<img/Screenshot 2023-12-13 195659.png>)

16. Настройте конфигурацию так, чтобы она собирала `.jar` в артефакты сборки.

> **Решение:**
> Добавил путь для артефактов
> ![Настройка артефактов](<img/image-2.png>)

17. Проведите повторную сборку мастера, убедитесь, что сбора прошла успешно и артефакты собраны.

> **Решение:**
> ![Сборка с артефактами](<img/Screenshot 2023-12-13 201130.png>)

18. Проверьте, что конфигурация в репозитории содержит все настройки конфигурации из teamcity.
19. В ответе пришлите ссылку на репозиторий.

> **Решение:**
> [my example-teamcity fork](https://github.com/P0zitiff4ik/example-teamcity/tree/master)

---